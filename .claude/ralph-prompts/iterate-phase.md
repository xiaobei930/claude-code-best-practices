# Ralph Loop 提示词模板 - Phase 迭代

## 项目上下文

你正在开发 {{PROJECT_NAME}}，{{PROJECT_DESCRIPTION}}。

本模板与项目的 `/cc-best:iterate` 命令逻辑一致，实现跨会话的 Phase 迭代。

---

## 核心流程

```
读取 progress.md → 确定角色 → 执行任务 → 验证 → 提交 → 更新文档 → 下一任务
```

## 角色选择规则

| 当前状态         | 选择角色    | 动作                   |
| ---------------- | ----------- | ---------------------- |
| 无需求文档       | `/cc-best:pm`       | 需求分析，创建 REQ-XXX |
| REQ 有待澄清项   | `/cc-best:clarify`  | 需求澄清               |
| 有需求无设计     | `/cc-best:lead`     | 技术设计，创建 DES-XXX |
| 有设计，前端任务 | `/cc-best:designer` | UI 设计指导            |
| 有任务待开发     | `/cc-best:dev`      | 编码实现               |
| 有代码待测试     | `/cc-best:qa`       | 验证测试               |
| QA 发现 Bug      | `/cc-best:dev`      | 修复后重新 `/cc-best:qa`       |

## 每次迭代执行步骤

1. **读取上下文**
   - `memory-bank/progress.md` - 当前状态和待办任务
   - `CLAUDE.md` - 核心约束和原则

2. **确定角色和任务**
   - 根据上表选择角色
   - 从 TSK 列表选择优先级最高的任务

3. **执行任务**
   - 按角色职责执行
   - 遵循编码规范和约束

4. **验证结果**
   - `/cc-best:test` - 运行测试
   - `/cc-best:build` - 构建验证
   - 前端任务使用浏览器验证

5. **提交和更新**
   - `/cc-best:commit` - Conventional Commits 格式
   - 更新 `memory-bank/progress.md`

6. **继续下一任务**（不等待用户）

---

## 完成标准

当满足以下**所有**条件时输出 `<promise>PHASE_COMPLETE</promise>`：

- [ ] 当前 Phase 的所有 TSK 任务已完成
- [ ] 所有测试通过
- [ ] 代码已提交
- [ ] progress.md 状态已更新
- [ ] 无阻塞问题

---

## 关键规则（来自 CLAUDE.md）

1. **P1 接口处理** - 调用前必须查阅文档，**禁止猜测**
2. **P3 业务理解** - 必须来源于明确需求，**禁止假设**
3. **P7 诚信沟通** - 信息不完整时必须说明
4. **CP4 简洁执念** - 函数单一职责，嵌套 ≤ 3 层
5. **A1 上下文推断** - 基于项目上下文推断，**不中断询问用户**
6. **A2 决策记录** - 记录依据和置信度

---

## 卡住时的处理

如果连续 3 次迭代没有进展：

1. 在 progress.md 记录阻塞原因
2. 列出已尝试的方案
3. 分析可能的替代方案
4. 输出 `<promise>BLOCKED</promise>` 等待人工介入

---

## 输出格式

```markdown
## Phase 迭代 #N

### 当前状态

- **Phase**: [Phase 名称]
- **角色**: [/cc-best:pm | /cc-best:lead | /cc-best:dev | /cc-best:qa]
- **任务**: TSK-XXX [任务名称]

### 执行动作

1. [动作1]
2. [动作2]

### 产出物

- 文档: [创建/更新的文档]
- 代码: [修改的文件]
- 测试: [测试结果]
- 提交: [commit hash]

### 决策记录

| 决策点  | 选择   | 依据   | 置信度   |
| ------- | ------ | ------ | -------- |
| [决策1] | [选择] | [依据] | 高/中/低 |

### 下一步

[下一任务 TSK-XXX 或完成信号]
```
