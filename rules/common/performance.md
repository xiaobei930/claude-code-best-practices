---
paths:
  - "**/*"
description: 模型选择和上下文管理的性能优化策略
alwaysApply: true
---

# 性能优化策略

## 模型选择指南

| 场景     | 推荐模型 | 原因     |
| -------- | -------- | -------- |
| 架构设计 | Opus     | 深度推理 |
| 代码实现 | Sonnet   | 均衡质量 |
| 代码审查 | Opus     | 架构判断 |
| 简单查询 | Haiku    | 成本优化 |
| 快速任务 | Haiku    | 速度优先 |
| TDD 循环 | Sonnet   | 高频迭代 |
| 安全审查 | Opus     | 不漏关键 |

## 上下文窗口管理

- 上下文末尾 20% 时避免：大规模重构、跨多文件实现、复杂调试
- 低上下文敏感任务：单文件编辑、工具函数、文档更新、简单 bug 修复
- 复杂任务使用 `ultrathink` 或 Plan Mode

## 并行与 MCP

- 多个独立任务时在单个消息中发起多个 Task 调用实现并行
- MCP 每项目不超过 10 个，活跃工具不超过 80 个
- 构建失败时使用 build-error-resolver agent 增量修复
